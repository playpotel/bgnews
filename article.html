<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Зареждане...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- OG placeholder (Worker akan replace) -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="">
  <meta property="og:description" content="">
  <meta property="og:image" content="https://bgnews.pages.dev/og-default.jpg">
  <meta property="og:site_name" content="BG News">

  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#f4f6f8; }
    main { max-width:800px; margin:auto; background:#fff; padding:1rem; }
    h1 { font-size:1.4rem; }
    .meta { font-size:.8rem; color:#666; margin-bottom:1rem; }
    img { max-width:100%; border-radius:6px; margin:1rem 0; }
    .ad { margin:1.5rem 0; text-align:center; }
    a.original { font-weight:600; display:inline-block; margin-top:1rem; }
  </style>
</head>
<body>

<main>
  <div id="article">Зареждане...</div>

  <!-- ADSTERRA (DELAYED) -->
  <div class="ad" id="ad"></div>
</main>

<script>
const API = 'https://bg-news-api.playpotel.workers.dev/';
const params = new URLSearchParams(location.search);
const id = params.get('id');

function articleId(link) {
  let h = 0;
  for (let i = 0; i < link.length; i++) {
    h = ((h << 5) - h) + link.charCodeAt(i);
    h |= 0;
  }
  return Math.abs(h).toString();
}

function extractImage(html) {
  if (!html) return null;
  const m = html.match(/<img[^>]+src=["']([^"']+)["']/i);
  return m ? m[1] : null;
}

if (!id) {
  document.getElementById('article').textContent = 'Няма избрана статия';
} else {
  fetch(API)
    .then(r => r.json())
    .then(data => {
      const item = data.items.find(x => articleId(x.link) === id);
      if (!item) {
        document.getElementById('article').textContent = 'Статията не е намерена';
        return;
      }

      const img = extractImage(item.description);

      document.title = item.title;

      document.getElementById('article').innerHTML = `
        <h1>${item.title}</h1>
        <div class="meta">
          ${item.source || ''} · ${new Date(item.pubDate).toLocaleString('bg-BG')}
        </div>
        ${img ? `<img src="${img}">` : ''}
        <p>${item.description || ''}</p>
        <a class="original" href="${item.link}" target="_blank">
          Прочети оригинала →
        </a>
      `;
    })
    .catch(() => {
      document.getElementById('article').textContent = 'Грешка при зареждане';
    });
}

// delay ads (speed boost)
setTimeout(() => {
  const s1 = document.createElement('script');
  s1.text = `
    atOptions = {
      'key' : 'dff5c4c5dd22bf5b09bab809923da74a',
      'format' : 'iframe',
      'height' : 250,
      'width' : 300,
      'params' : {}
    };
  `;
  const s2 = document.createElement('script');
  s2.src = 'https://tuckerclassesjackal.com/dff5c4c5dd22bf5b09bab809923da74a/invoke.js';
  document.getElementById('ad').appendChild(s1);
  document.getElementById('ad').appendChild(s2);
}, 1500);
</script>

</body>
</html>
